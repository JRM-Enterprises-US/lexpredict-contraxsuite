# -*- coding: utf-8 -*-
# Generated by Django 1.11.18 on 2019-03-05 15:13
from __future__ import unicode_literals

from django.conf import settings
import django.contrib.postgres.fields.jsonb
import django.core.serializers.json
import django.core.validators
from django.db import migrations, models
import django.db.models.deletion
from apps.common.model_utils.improved_django_json_encoder import ImprovedDjangoJSONEncoder


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('users', '0009_user_timezone'),
        ('document', '0123_auto_20190218_1341'),
    ]

    operations = [
        migrations.CreateModel(
            name='DocumentDigestConfig',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('enabled', models.BooleanField(default=False)),
                ('documents_filter', models.CharField(choices=[('new_assigned_documents', 'Documents assigned to the destination user during the period'), ('loaded_documents', 'Documents loaded into the projects the user has access to'), ('non_reviewed_documents', 'Non-reviewed documents of the destination user'), ('uncompleted_documents', 'Uncompleted documents of the destination user')], max_length=100)),
                ('period', models.CharField(blank=True, choices=[('after_last_run', 'After last run'), ('prev_day', 'Previous day'), ('prev_week', 'Previous week'), ('this_day', 'This day'), ('this_week', 'This week')], max_length=100, null=True)),
                ('template', models.CharField(choices=[('document_list', 'document_list')], max_length=128)),
                ('subject', models.CharField(blank=True, help_text='Template of the email subject in \n    Jinja2 syntax. Leave empty for using the default. The following items are passed to the context: to_user: User, event_initiator: User, documents: List[Dict[str, Any]], \n    period_start: datetime, period_end: datetime.', max_length=1024, null=True)),
                ('header', models.CharField(blank=True, help_text='Template of the header\n    in Jinja2 syntax. Leave empty for using the default. The following items are passed to the context: to_user: User, event_initiator: User, documents: List[Dict[str, Any]], \n    period_start: datetime, period_end: datetime.\n    ', max_length=2048, null=True)),
                ('generic_fields', django.contrib.postgres.fields.jsonb.JSONField(default=['status_name'], encoder=ImprovedDjangoJSONEncoder)),
                ('run_at_day_of_week', models.PositiveSmallIntegerField(blank=True, choices=[(1, 'Monday'), (2, 'Tuesday'), (3, 'Wednesday'), (4, 'Thursday'), (5, 'Friday'), (6, 'Saturday'), (7, 'Sunday')], null=True, validators=[django.core.validators.MaxValueValidator(7), django.core.validators.MinValueValidator(1)])),
                ('run_at_hour', models.PositiveSmallIntegerField(blank=True, default=9, null=True, validators=[django.core.validators.MaxValueValidator(23), django.core.validators.MinValueValidator(0)])),
                ('run_at_minute', models.PositiveSmallIntegerField(blank=True, default=0, null=True, validators=[django.core.validators.MaxValueValidator(59), django.core.validators.MinValueValidator(0)])),
                ('document_fields', models.ManyToManyField(blank=True, help_text='Fields of the documents to \n    render in the email. Should match the specified document type. Leave empty for rendering all fields.\n    ', to='document.DocumentField')),
                ('document_type', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='document.DocumentType')),
                ('for_role', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='users.Role')),
                ('for_user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='DocumentDigestSendDate',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date', models.DateTimeField(db_index=True)),
                ('config', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='notifications.DocumentDigestConfig')),
                ('to', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.AddIndex(
            model_name='documentdigestsenddate',
            index=models.Index(fields=['config', 'to', '-date'], name='notificatio_config__a15f6f_idx'),
        ),
    ]
